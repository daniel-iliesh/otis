<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OTiS-Optimised Template System</title>
    <link rel="icon" type="image/x-icon" href="otis.png">

    <script src="./lib/jquery.js"></script>
    <script src="./lib/jszip.js"></script>
    <script src="./lib/xlsx.js"></script>
    <link rel="stylesheet" href="./lib/bootstrap.css"></style>
  </head>

  <body>
    <div class="container-fluid">
      <div class="flex-wrap container-styling" id="containerStyling">
        <div class="row">
          <div class="col d-flex flex-column justify-content-between">
            <div class="">
              <div
                class="d-flex w-100 align-items-center justify-content-center"
              >
                <h3>NOTE</h3>
              </div>
              <form id="noteForm" autocomplete="off">
                <div class="row">
                  <div class="col d-flex flex-column justify-content-between">
                    <div>
                      <div class="d-flex justify-content-center">
                        <select
                          class="form-select form-select-sm"
                          id="txtInteractionType"
                          name="txtInteractionType"
                        >
                          <option value="Inbound">Inbound</option>
                          <option value="Outbound/Callback">
                            Outbound/Callback
                          </option>
                          <option value="Offline Work">Offline Work</option>
                          <option value="Supervisor Assistance">
                            Supervisor Assistance
                          </option>
                        </select>
                      </div>
                      <div class="d-flex justify-content-center">
                        <input
                          class="general form-control form-control-sm"
                          id="customername"
                          placeholder="Customer name"
                          name="customername"
                          type="text"
                          title="Customer name"
                        />
                      </div>
                      <div class="d-flex justify-content-center">
                        <input
                          placeholder="BAN"
                          class="general form-control form-control-sm"
                          id="ban"
                          name="ban"
                          maxlength="9"
                          type="text"
                          title="Account number"
                        />
                      </div>
                      <div class="ptn-container d-flex justify-content-center">
                        <input
                          placeholder="PTN"
                          class="general form-control form-control-sm"
                          id="ptn"
                          name="ptn"
                          type="text"
                          title="Phone number"
                          maxlength="12"
                        />
                        <button
                          title="Remove upgrade reservation"
                          class="upgres"
                        >
                          <svg
                            style="width: 16px"
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 512 512"
                          >
                            <path
                              d="M224 0c-35.3 0-64 28.7-64 64V288c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H224zM64 160c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H288c35.3 0 64-28.7 64-64V384H288v64H64V224h64V160H64z"
                            />
                          </svg>
                        </button>
                      </div>
                      <div class="d-flex justify-content-center">
                        <input
                          placeholder="Callback number"
                          class="general form-control form-control-sm"
                          id="callbacknumber"
                          name="callbacknumber"
                          type="text"
                          title="Callback number"
                          maxlength="12"
                        />
                      </div>
                      <div class="d-flex justify-content-center">
                        <span class="mx-1">RC</span>
                        <div class="form-check form-switch">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            name="repeatcaller"
                            id="repeatcaller"
                          />
                        </div>
                      </div>
                      <div class="d-flex justify-content-center">
                        <div class="d-flex w-100">
                          <select
                            class="general no-border-right form-select form-select-sm"
                            id="authmethod"
                            style="width: 40%"
                            name="authmethod"
                          >
                            <option value="">(Select One)</option>
                            <option value="PIN">PIN</option>
                            <option value="SQA">SQA</option>
                            <option value="A2A">A2A</option>
                            <option value="IVR">IVR</option>
                            <option value="Reduced">Reduced</option>
                          </select>
                          <input
                            type="text"
                            title="Auth code"
                            placeholder="Auth Type"
                            id="authpasscode"
                            class="no-border-left form-control form-control-sm"
                          />
                        </div>
                      </div>
                      <div class="d-flex justify-content-center">
                        <input
                          placeholder="Agent ELID"
                          class="general form-control form-control-sm"
                          id="agentelid"
                          name="agentelid"
                          type="text"
                          title="Agent ELID"
                        />
                      </div>
                      <div class="d-flex justify-content-center">
                        <select
                          class="form-select form-select-sm"
                          id="transfer"
                          name="transfer"
                        >
                          <option value="No Transfer">No Transfer</option>
                          <option value="Warm">Warm</option>
                          <option value="Cold">Cold</option>
                        </select>
                      </div>
                      <div class="d-flex justify-content-center">
                        <input
                          placeholder="Order number"
                          class="general form-control form-control-sm"
                          id="ordernumber"
                          name="ordernumber"
                          type="text"
                          title="Order number"
                          placeholder="If retail, provide receipt number (if available)"
                        />
                      </div>
                      <div class="d-flex justify-content-center">
                        <select
                          class="form-select form-select-sm"
                          id="ordertype"
                          name="ordertype"
                        >
                          <option value="n/a">Order Type</option>
                          <option value="Telesales Direct Ship">
                            Telesales Direct Ship
                          </option>
                          <option value="Websales Direct Ship">
                            Websales Direct Ship
                          </option>
                          <option value="DM14 (FDT)">DM14 (FDT)</option>
                          <option value="BOPUIS">BOPUIS</option>
                          <option value="GST Direct Ship">
                            GST Direct Ship
                          </option>
                          <option value="Corporate Liable (CL)">
                            Corporate Liable (CL)
                          </option>
                          <option value="Retail In-Store Purchase">
                            Retail In-Store Purchase
                          </option>
                          <option value="Contact not related to order">
                            Contact not related to order
                          </option>
                        </select>
                      </div>
                      <div class="d-flex justify-content-center">
                        <select
                          class="form-select form-select-sm"
                          id="programsite"
                          name="programsite"
                        >
                          <option value="OS/Romania">OS/Romania</option>
                          <option value="ESC/Romania">ESC/Romania</option>
                        </select>
                      </div>
                    </div>
                    <div>
                      <div class="d-flex justify-content-evenly w-100">
                        <div class="form-check form-switch">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            name="flexSwitchCheckDefault"
                            id="smartSwitch"
                          />
                          <label
                            class="form-check-label"
                            for="flexSwitchCheckDefault"
                            >SMART</label
                          >
                        </div>
                        <div class="form-check form-switch">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            name="flexSwitchCheckDefault"
                            id="emailSwitch"
                          />
                          <label
                            class="form-check-label"
                            for="flexSwitchCheckDefault"
                            >EMAIL</label
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col">
                    <div
                      class="d-flex justify-content-between align-items-center"
                    >
                      <svg
                        id="noteTemplateRefreshBtn"
                        class="m-1"
                        style="width: 16px; fill: white"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 512 512"
                      >
                        <path
                          d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z"
                        />
                      </svg>

                      <select
                        class="w-75 form-select w-50 form-select-sm"
                        id="selectNotesTemplates"
                        name="notes_templates"
                      ></select>
                    </div>
                    <div class="flex-content-center">
                      <input
                        class="form-control form-control-sm"
                        id="txtCallReason"
                        placeholder="Reason for Call"
                        name="txtCallReason"
                      />
                      <div class="flex-content-between">
                        <div class="d-flex flex-row justify-content-between">
                          <label class="-labels" for="txtResolution"
                            >Resolution :</label
                          >
                          <div class="form-check form-switch">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              name="flexSwitchCheckDefault"
                              id="a2aSwitch"
                            />
                            <label
                              class="form-check-label"
                              for="flexSwitchCheckDefault"
                              >A2A</label
                            >
                          </div>
                        </div>
                        <textarea
                          class="scrollbar-hidden form-control form-control-sm"
                          id="txtResolution"
                          name="txtResolution"
                          value="Customer called in as"
                          rows="4"
                          cols="50"
                        ></textarea>
                      </div>
                      <div
                        id="fastFillNote"
                        class="d-flex flex-row flex-wrap"
                      ></div>
                      <div class="flex-content-between">
                        <label class="-labels" for="txtNotation">Note :</label>
                        <textarea
                          class="scrollbar-hidden form-control form-control-sm"
                          id="txtNotation"
                          name="txtNotation"
                          rows="5"
                          cols="30"
                          wrap="soft"
                          title="Select all and copy text."
                          readonly=""
                        ></textarea>
                      </div>

                      <div
                        class="d-flex flex-row justify-content-center align-items-center mt-5"
                      >
                        <div id="modalToggle">
                          <svg
                            class="m-1"
                            style="width: 24px; fill: white"
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 512 512"
                          >
                            <path
                              d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336c44.2 0 80-35.8 80-80s-35.8-80-80-80s-80 35.8-80 80s35.8 80 80 80z"
                            />
                          </svg>
                        </div>
                        <input
                          class="btn-responsive btn btn-danger btn-sm"
                          type="button"
                          value="Reset Form"
                          id="resetBTN"
                        />&nbsp;&nbsp;&nbsp;
                        <input
                          class="btn-responsive btn btn-primary btn-sm"
                          type="button"
                          value="Copy Note"
                          onclick="copyNote()"
                          name="txtNotation"
                          id="copyBTN"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div
          id="modal"
          class="modal d-flex flex-column align-items-center justify-content-between"
          style="z-index: 999"
        >
          <div id="closeModal" class="align-self-end mb-1">
            <svg
              style="width: 24px; fill: white"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 320 512"
            >
              <path
                d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"
              />
            </svg>
          </div>
          <div>
            <h4 class="text-center">Theme</h4>
            <div
              class="d-flex justify-content-between justify-content-center align-items-center"
            >
              <label class="-labels" style="margin-right: 20px" for="mainColor"
                >Main color:
              </label>
              <input
                name="mainColor"
                class=""
                type="color"
                id="colorPicker"
                style="border-radius: 50%; width: 40px; height: 40px"
              />
            </div>
            <div
              class="d-flex justify-content-between justify-content-between align-items-center"
            >
              <label class="-labels" style="margin-right: 20px" for="mainColor"
                >Text color:
              </label>
              <input
                name="mainColor"
                class=""
                type="color"
                id="colorPickerText"
                style="border-radius: 50%; width: 40px; height: 40px"
              />
            </div>
          </div>
          <div>
            <div class="text-center">
              ______________________________________________________________
            </div>
            <h4 class="text-center">Import templates from spreadsheet</h4>
            <div class="d-flex m-2 justify-content-center">
              <form enctype="multipart/form-data">
                <input
                  id="uploadNotesTemplates"
                  type="file"
                  name="notes_templates"
                />
              </form>
            </div>
          </div>
          <div>
            <label for="signature"> Signature : </label>
            <textarea
              class="scrollbar-hidden form-control form-control-sm"
              id="signature"
              name="signature"
              rows="4"
              cols="50"
              wrap="soft"
            ></textarea>
            <input
              class="btn-responsive btn btn-primary btn-sm"
              type="button"
              value="Save"
              name="saveSignatureBtn"
              id="saveSignatureBtn"
            />
          </div>
        </div>
      </div>

      <div>
        <div class="row">
          <div id="smart" class="col container-styling" style="display: none">
            <form id="smartForm" autocomplete="off">
              <div
                class="d-flex w-100 align-items-center justify-content-center"
              >
                <h3>SMART</h3>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <svg
                  id="smartTemplateRefreshBtn"
                  class="m-1"
                  style="width: 16px; fill: white"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 512 512"
                >
                  <path
                    d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z"
                  />
                </svg>
                <select
                  class="form-select w-75 form-select-sm"
                  id="selectSmartTemplates"
                  name="smart_templates"
                ></select>
              </div>
              <div class="flex-content-between">
                <div class="flex-content-between">
                  <div class="d-flex flex-row justify-content-between">
                    <label class="-labels" for="smartContent">Content :</label>
                  </div>
                  <textarea
                    class="scrollbar-hidden form-control form-control-sm"
                    id="smartContent"
                    name="smartContent"
                    rows="4"
                    cols="50"
                    wrap="soft"
                  ></textarea>
                </div>
                <div id="fastFillSmart" class="d-flex flex-row flex-wrap"></div>
                <div class="flex-content-between">
                  <label class="-labels" for="smartNote">SMART :</label>
                  <textarea
                    class="scrollbar-hidden form-control form-control-sm"
                    id="smartNote"
                    name="smartNote"
                    rows="5"
                    cols="30"
                    wrap="soft"
                    title="Select all and copy text."
                    readonly=""
                  ></textarea>
                </div>

                <div
                  class="d-flex flex-row justify-content-center align-items-center mt-5"
                >
                  <form enctype="multipart/form-data">
                    <input
                      id="uploadSmartTemplates"
                      class="upload-icon"
                      type="file"
                      name="smart_templates"
                    />
                    <svg
                      style="width: 60px; fill: white; margin-right: 5px"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 512 512"
                    >
                      <path
                        d="M288 109.3V352c0 17.7-14.3 32-32 32s-32-14.3-32-32V109.3l-73.4 73.4c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l128-128c12.5-12.5 32.8-12.5 45.3 0l128 128c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L288 109.3zM64 352H192c0 35.3 28.7 64 64 64s64-28.7 64-64H448c35.3 0 64 28.7 64 64v32c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V416c0-35.3 28.7-64 64-64zM432 456c13.3 0 24-10.7 24-24s-10.7-24-24-24s-24 10.7-24 24s10.7 24 24 24z"
                      />
                    </svg>
                  </form>
                  <input
                    class="btn-responsive btn btn-danger btn-sm"
                    type="button"
                    value="Reset"
                    id="resetSmartBTN"
                  />&nbsp;&nbsp;&nbsp;
                  <input
                    class="btn-responsive btn btn-primary btn-sm"
                    type="button"
                    value="Copy"
                    onclick="copySmart()"
                    name="smartNote"
                    id="copyBTN"
                  />
                </div>
              </div>
            </form>
          </div>

          <div id="email" class="col container-styling" style="display: none">
            <form id="emailForm" autocomplete="off">
              <div
                class="d-flex w-100 align-items-center justify-content-center"
              >
                <h3>EMAIL</h3>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <svg
                  id="emailTemplateRefreshBtn"
                  class="m-1"
                  style="width: 16px; fill: white"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 512 512"
                >
                  <path
                    d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z"
                  />
                </svg>

                <select
                  class="form-select w-75 form-select-sm"
                  id="selectEmailTemplates"
                  name="email_templates"
                ></select>
              </div>
              <div class="flex-content-between">
                <label class="-labels" for="emailSubject">Subject :</label>
                <input
                  class="form-control form-control-sm"
                  id="emailSubject"
                  name="emailSubject"
                />
                <div class="flex-content-between">
                  <div class="d-flex flex-row justify-content-between">
                    <label class="-labels" for="emailContent">Content :</label>
                  </div>
                  <textarea
                    class="scrollbar-hidden form-control form-control-sm"
                    id="emailContent"
                    name="emailContent"
                    rows="4"
                    cols="50"
                    wrap="soft"
                  ></textarea>
                </div>
                <div id="fastFillEmail" class="d-flex flex-row flex-wrap"></div>
                <div class="flex-content-between">
                  <label class="-labels" for="emailRequest">Request :</label>
                  <textarea
                    class="scrollbar-hidden form-control form-control-sm"
                    id="emailRequest"
                    name="emailRequest"
                    rows="5"
                    cols="30"
                    wrap="soft"
                    title="Select all and copy text."
                    readonly=""
                  ></textarea>
                </div>

                <div
                  class="d-flex flex-row justify-content-center align-items-center mt-5"
                >
                  <form enctype="multipart/form-data">
                    <input
                      id="uploadEmailTemplates"
                      class="upload-icon"
                      type="file"
                      name="email_templates"
                    />
                    <svg
                      style="width: 60px; fill: white; margin-right: 5px"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 512 512"
                    >
                      <path
                        d="M288 109.3V352c0 17.7-14.3 32-32 32s-32-14.3-32-32V109.3l-73.4 73.4c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l128-128c12.5-12.5 32.8-12.5 45.3 0l128 128c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L288 109.3zM64 352H192c0 35.3 28.7 64 64 64s64-28.7 64-64H448c35.3 0 64 28.7 64 64v32c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V416c0-35.3 28.7-64 64-64zM432 456c13.3 0 24-10.7 24-24s-10.7-24-24-24s-24 10.7-24 24s10.7 24 24 24z"
                      />
                    </svg>
                  </form>
                  <input
                    class="btn-responsive btn btn-danger btn-sm"
                    type="button"
                    value="Reset"
                    id="resetEmailBTN"
                  />&nbsp;&nbsp;&nbsp;
                  <input
                    class="btn-responsive btn btn-primary btn-sm"
                    type="button"
                    value="Copy"
                    onclick="copyEmail()"
                    name="emailRequest"
                    id="copyBTN"
                  />
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script>
      let regExp = /^\d+$/;
      let placeholderWordExp = /\[(.*?)\]/g;

      let generalFields = [
        $("#customername"),
        $("#ban"),
        $("#ptn"),
        $("#callbacknumber"),
        $("#repeatcaller"),
        $("#authmethod"),
        $("#authpasscode"),
        $("#agentelid"),
        $("#transfer"),
        $("#ordernumber"),
        $("#ordertype"),
        $("#programsite"),
      ];

      // prevent default behaviour on Enter button press
      $(document).keypress(function (event) {
        if (event.which == "13") {
          event.stopPropagation();
        }
      });

      const convertToID = (element) => {
        return element.toLowerCase().split(" ").join("");
      };

      $("#smartSwitch").on("input", () => {
        if ($("#smartSwitch").is(":checked")) {
          $("#smart").show();
        } else {
          $("#smart").hide();
        }
      });

      $("#emailSwitch").on("input", () => {
        if ($("#emailSwitch").is(":checked")) {
          $("#email").show();
        } else {
          $("#email").hide();
        }
      });

      // get data from excel file
      var getTemplatesFromTable = function (templates_category_name) {
        this.parseExcel = function (file) {
          var reader = new FileReader();

          reader.onload = function (e) {
            var data = e.target.result;
            var workbook = XLSX.read(data, {
              type: "binary",
            });
            workbook.SheetNames.forEach(function (sheetName) {
              var XL_row_object = XLSX.utils.sheet_to_json(
                workbook.Sheets[sheetName],
                { raw: true, defval: null }
              );
              var json_object = JSON.stringify(XL_row_object);
              const templates_object = JSON.parse(json_object)[0];
              setTemplates(templates_category_name, templates_object);
              populateSelect(templates_category_name);
              reloadTemplates();
            });
          };

          reader.onerror = function (ex) {};

          reader.readAsBinaryString(file);
        };
      };

      const handleTemplatesUpload = (evt) => {
        const files = evt.target.files;
        const xl2json = new getTemplatesFromTable(evt.target.name);
        xl2json.parseExcel(files[0]);
      };

      let templates_categories = [
        "notes_templates",
        "email_templates",
        "smart_templates",
      ];

      const setTemplates = (templates_category_name, templates_object) => {
        for (const [key, value] of Object.entries(templates_object)) {
          if (value.includes("&#10;")) {
            templates_object[key] = templates_object[key].replaceAll(
              "&#10;",
              "\n"
            );
          }
        }
        localStorage.setItem(
          templates_category_name,
          JSON.stringify(templates_object)
        );
      };

      const initTemplates = () => {
        Object.values(templates_categories).forEach((template_category) => {
          localStorage.setItem(template_category, JSON.stringify({}));
        });
      };

      const populateSelect = (templates_category_name) => {
        $(`select[name='${templates_category_name}']`).html("");

        if (JSON.parse(localStorage.getItem("notes_templates")) === null) {
          initTemplates();
        }

        for (const [key, value] of Object.entries(
          JSON.parse(localStorage.getItem(templates_category_name))
        )) {
          let option = document.createElement("option");
          option.innerText = key;
          option.value = key;

          $("select[name='" + templates_category_name + "']").append(option);
        }
      };

      // Styling the tool here

      $("#containerStyling").css(
        "background-color",
        JSON.parse(localStorage.getItem("color")) || "#226c6d"
      );

      $("#containerStyling").css(
        "color",
        JSON.parse(localStorage.getItem("text")) || "white"
      );

      $("#email").css(
        "background-color",
        JSON.parse(localStorage.getItem("color")) || "#226c6d"
      );

      $("#email").css(
        "color",
        JSON.parse(localStorage.getItem("text")) || "white"
      );

      $("#smart").css(
        "background-color",
        JSON.parse(localStorage.getItem("color")) || "#226c6d"
      );

      $("#smart").css(
        "color",
        JSON.parse(localStorage.getItem("text")) || "white"
      );

      $("#modal").css(
        "background-color",
        JSON.parse(localStorage.getItem("color")) || "#226c6d"
      );

      $("#colorPicker").val(
        JSON.parse(localStorage.getItem("color")) || "#226c6d"
      );

      $("#colorPickerText").val(
        JSON.parse(localStorage.getItem("text")) || "white"
      );

      // Styling END

      $("#a2aSwitch").on("input", () => {
        if ($("#a2aSwitch").is(":checked")) {
          $("#txtResolution").val(
            $("#txtResolution")
              .val()
              .replace(
                "Customer called in ",
                "Agent called in on behalf of the customer "
              )
          );
        } else {
          $("#txtResolution").val(
            $("#txtResolution")
              .val()
              .replace(
                "Agent called in on behalf of the customer ",
                "Customer called in "
              )
          );
        }
      });

      $("#ptn").on("change", (e) => {
        e.preventDefault();
        let formatedPTN = $("#ptn").val().split("-").join("");
        $("#ptn").val(formatedPTN);
        if ($("#callbacknumber").val() == "") {
          $("#callbacknumber").val(formatedPTN);
        }
      });

      $("#callbacknumber").on("change", (e) => {
        e.preventDefault();
        let formatedCallbacknumber = $("#callbacknumber")
          .val()
          .split("-")
          .join("");
        $("#callbacknumber").val(formatedCallbacknumber);
      });

      $("#resetBTN").on("mousedown", (e) => {
        $("#fastFillNote").html("");
        $("#email").hide();
        $("#smart").hide();
        $("#noteForm").trigger("reset");
        refreshNoteTemplate();
        updateFinalNote();
      });

      $("#resetEmailBTN").on("mousedown", (e) => {
        $("#fastFillEmail").html("");
        $("#emailForm").trigger("reset");
        refreshEmailTemplate();
        updateFinalEmail();
      });

      $("#resetSmartBTN").on("mousedown", (e) => {
        $("#fastFillSmart").html("");
        $("#smartForm").trigger("reset");
        refreshSmartTemplate();
        updateFinalSmart();
      });

      $("#modalToggle").on("click", () => {
        $("#modal").prop("classList").add("show");
      });
      $("#closeModal").on("click", () => {
        $("#modal").prop("classList").remove("show");
      });

      $("#colorPicker").on("input", () => {
        localStorage.setItem("color", JSON.stringify($("#colorPicker").val()));

        $("#containerStyling").css(
          "background-color",
          JSON.parse(localStorage.getItem("color")) || "#226c6d"
        );

        $("#smart").css(
          "background-color",
          JSON.parse(localStorage.getItem("color")) || "#226c6d"
        );

        $("#email").css(
          "background-color",
          JSON.parse(localStorage.getItem("color")) || "#226c6d"
        );

        $("#modal").css(
          "background-color",
          JSON.parse(localStorage.getItem("color")) || "#226c6d"
        );
      });

      $("#colorPickerText").on("input", () => {
        localStorage.setItem(
          "text",
          JSON.stringify($("#colorPickerText").val())
        );
        $("#containerStyling").css(
          "color",
          JSON.parse(localStorage.getItem("text")) || "white"
        );

        $("#modal").css(
          "color",
          JSON.parse(localStorage.getItem("text")) || "white"
        );

        $("#smart").css(
          "color",
          JSON.parse(localStorage.getItem("text")) || "white"
        );

        $("#email").css(
          "color",
          JSON.parse(localStorage.getItem("text")) || "white"
        );
      });

      $("#noteTemplateRefreshBtn").on("click", (e) => {
        e.preventDefault();
        refreshNoteTemplate();
      });

      $("#smartTemplateRefreshBtn").on("click", (e) => {
        e.preventDefault();
        refreshSmartTemplate();
      });

      $("#emailTemplateRefreshBtn").on("click", (e) => {
        e.preventDefault();
        refreshEmailTemplate();
      });

      // FASTFILL FEATURE

      let notesPlaceholders = [];
      let currentNotesState = {};

      const notesAppendFastFill = () => {
        currentNotesState = {};
        for (const [key, value] of Object.entries(
          JSON.parse(localStorage.getItem("notes_templates"))
        )) {
          if ($("#selectNotesTemplates").val() == key) {
            $("#txtCallReason").val(
              $("#selectNotesTemplates").val() == "No template" ? "" : key
            );
            $("#txtResolution").val(value == undefined ? "" : value);
          }
        }
        $("#fastFillNote").html("");
        notesPlaceholders = [
          ...$("#txtResolution").val().matchAll(placeholderWordExp),
        ];
        notesPlaceholders.forEach((element, index) => {
          let inputField = document.createElement("input");
          inputField.setAttribute("type", "text");
          inputField.setAttribute("title", element[1]);
          inputField.setAttribute(
            "class",
            "note form-control form-control-sm w-50"
          );
          inputField.setAttribute("placeholder", element[1]);
          let id = "note_" + element[1].split(" ").join("").toLowerCase();
          inputField.setAttribute("id", id);
          if (index % 2 == 0) {
            inputField.classList.add("no-border-right");
          } else {
            inputField.classList.add("no-border-left");
          }

          $("#fastFillNote").append(inputField);
        });
      };

      const refreshNoteTemplate = () => {
        notesAppendFastFill();
      };

      $("#selectNotesTemplates").on("input", () => {
        notesAppendFastFill();
        syncNoteWGeneral();
      });

      $("#emailContent").on("input", () => {
        updateFinalEmail();
      });

      const updateFastFillNote = () => {
        notesPlaceholders.forEach((element, index) => {
          const ffInput = $(
            `#note_${element[1].split(" ").join("").toLowerCase()}`
          );
          let currentElement = element[1].split(" ").join("");
          if (ffInput.val() !== "") {
            if (
              $("#txtResolution")
                .val()
                .includes(currentNotesState[currentElement])
            ) {
              $("#txtResolution").val(
                $("#txtResolution")
                  .val()
                  .replace(currentNotesState[currentElement], ffInput.val())
              );
              currentNotesState[currentElement] = ffInput.val();
            } else {
              $("#txtResolution").val(
                $("#txtResolution").val().replace(element[0], ffInput.val())
              );
              currentNotesState[currentElement] = ffInput.val();
            }
          }
        });
      };

      $("#authpasscode").on("change", () => {
        if (regExp.test($("#authpasscode").val())) {
          $("#authmethod").val("PIN");
        } else {
          $("#authmethod").val("SQA");
        }
      });

      $("#ban").on("change", () => {
        emailPlaceholders.forEach((element) => {
          // general
          if (element[1] === "BAN") {
            $(`#email_${convertToID(element[1])}`).val($("#ban").val());
          }
        });
      });

      $("#ptn").on("change", () => {
        emailPlaceholders.forEach((element) => {
          if (element[1] === "PTN") {
            $(`#email_${convertToID(element[1])}`).val(
              $("#callbacknumber").val()
            );
          }
        });
      });

      const updateFinalNote = () => {
        $("#txtNotation").val(
          "Interaction Type: " +
            $("#txtInteractionType").val() +
            " | Caller Name: " +
            $("#customername").val() +
            " | Callback Number: " +
            $("#callbacknumber").val() +
            " | BAN: " +
            $("#ban").val() +
            " | PTN: " +
            $("#ptn").val() +
            " | RC: " +
            ($("#repeatcaller").is(":checked") ? "Yes" : "No") +
            " | Auth: " +
            $("#authmethod").val() +
            " | Transfer: " +
            $("#transfer").val() +
            " | Agent ELID: " +
            ($("#agentelid").val() == "" ? "n/a" : $("#agentelid").val()) +
            // " | Call Source: " + $("#txtCallSource").val() +
            " | Order #: " +
            $("#ordernumber").val() +
            " | Order Type: " +
            $("#ordertype").val() +
            " | Program/Site: " +
            $("#programsite").val() +
            " | Reason for Call: " +
            $("#txtCallReason").val() +
            " | Resolution: " +
            $("#txtResolution").val()
        );
      };

      $("#fastFillNote").on("change", (e) => {
        e.preventDefault();
        updateFastFillNote();
        updateFinalNote();
        updateFinalSmart();
      });

      let inputs = document.querySelectorAll(".persistent");
      let changeAllowed = true;

      $("#noteForm").on("input", function (e) {
        e.preventDefault();

        updateFinalNote();
        updateFinalSmart();
        updateFinalEmail();

        $(".note").change(() => {
          syncEmailWGeneral();
          syncEmailWNote();
          syncSmartWNote();
        });
      });

      $(".general").change(() => {
        syncNoteWGeneral();
        syncEmailWGeneral();
        syncSmartWGeneral();
      });

      function copyNote() {
        $("#txtNotation").select();
        document.execCommand("copy");
      }

      // FASTFILL SMART

      let smartPlaceholders = [];
      let currentSmartState = {};

      const smartAppendFastFill = () => {
        currentSmartState = {};
        for (const [key, value] of Object.entries(
          JSON.parse(localStorage.getItem("smart_templates"))
        )) {
          if ($("#selectSmartTemplates").val() == key) {
            $("#smartReason").val(
              $("#selectSmartTemplates").val() == "No template" ? "" : key
            );
            $("#smartContent").val(value == undefined ? "" : value);
          }
        }

        $("#fastFillSmart").html("");
        smartPlaceholders = [
          ...$("#smartContent").val().matchAll(placeholderWordExp),
        ];

        let smartOptions = [
          "REFUND",
          "LOGISTICS",
          "RETURN",
          "RETURN AND EXCHANGE",
          "OTHER",
          "PROMOTIONS",
          "MONITOR",
          "RC CONTAINMENT",
          "CUSTOMER'S REQUEST",
        ];

        smartPlaceholders.forEach((element, index) => {
          if (element[1] === "Smart type") {
            var inputField = document.createElement("select");
            inputField.setAttribute(
              "class",
              "smart form-control form-control-sm w-50"
            );
            let id = "smart_" + element[1].split(" ").join("").toLowerCase();
            inputField.setAttribute("id", id);
            smartOptions.forEach((option) => {
              let smartOption = document.createElement("option");
              smartOption.value = option;
              smartOption.innerText = option;
              inputField.append(smartOption);
            });
          } else {
            var inputField = document.createElement("input");
            inputField.setAttribute("type", "text");
            inputField.setAttribute("title", element[1]);

            inputField.setAttribute(
              "class",
              "form-control form-control-sm w-50"
            );
            inputField.setAttribute("placeholder", element[1]);
            let id = "smart_" + element[1].split(" ").join("").toLowerCase();
            inputField.setAttribute("id", id);
          }
          if (index % 2 == 0) {
            inputField.classList.add("no-border-right");
          } else {
            inputField.classList.add("no-border-left");
          }
          $("#fastFillSmart").append(inputField);
        });
      };

      const refreshSmartTemplate = () => {
        smartAppendFastFill();
      };

      $("#selectSmartTemplates").on("input", () => {
        smartAppendFastFill();
        syncSmartWGeneral();
        syncSmartWNote();
      });

      const updateFinalSmart = () => {
        $("#smartNote").val(
          $("#smartContent").val() + "\nMy note: \n" + $("#txtNotation").val()
        );
      };

      const updateFastFillSmart = () => {
        smartPlaceholders.forEach((element, index) => {
          const ffInput = $(
            `#smart_${element[1].split(" ").join("").toLowerCase()}`
          );
          let currentElement = element[1].split(" ").join("");
          if (ffInput.val() !== "") {
            if (
              $("#smartContent")
                .val()
                .includes(currentSmartState[currentElement])
            ) {
              $("#smartContent").val(
                $("#smartContent")
                  .val()
                  .replace(currentSmartState[currentElement], ffInput.val())
              );
              currentSmartState[currentElement] = ffInput.val();
            } else {
              $("#smartContent").val(
                $("#smartContent").val().replace(element[0], ffInput.val())
              );
              currentSmartState[currentElement] = ffInput.val();
            }
          }
        });
      };

      $("#smartForm").on("input", function (e) {
        e.preventDefault();
        updateFinalSmart();
      });

      $("#fastFillSmart").on("change", (e) => {
        e.preventDefault();
        updateFastFillSmart();
        updateFinalSmart();
      });

      function copySmart() {
        $("#smartNote").select();
        document.execCommand("copy");
      }

      // FASTFILL EMAIL

      let emailPlaceholders = [];
      let currentEmailState = {};

      const emailAppendFastFill = () => {
        currentEmailState = {};
        for (const [key, value] of Object.entries(
          JSON.parse(localStorage.getItem("email_templates"))
        )) {
          if ($("#selectEmailTemplates").val() == key) {
            $("#emailReason").val($("#selectEmailTemplates").val() == key);
            $("#emailContent").val(value);
          }
        }
        $("#fastFillEmail").html("");
        emailPlaceholders = [
          ...$("#emailContent").val().matchAll(placeholderWordExp),
        ];
        emailPlaceholders.forEach((element, index) => {
          let inputField = document.createElement("input");
          inputField.setAttribute("type", "text");
          inputField.setAttribute("title", element[1]);

          inputField.setAttribute(
            "class",
            "email form-control form-control-sm w-50"
          );
          inputField.setAttribute("placeholder", element[1]);
          if (index % 2 == 0) {
            inputField.classList.add("no-border-right");
          } else {
            inputField.classList.add("no-border-left");
          }
          let id = "email_" + element[1].split(" ").join("").toLowerCase();
          inputField.setAttribute("id", id);

          $("#fastFillEmail").append(inputField);
        });
      };

      const refreshEmailTemplate = () => {
        emailAppendFastFill();
      };

      $("#selectEmailTemplates").on("input", () => {
        emailAppendFastFill();
        syncEmailWGeneral();
        syncEmailWNote();
      });

      const syncNoteWGeneral = () => {
        notesPlaceholders.forEach((element) => {
          generalFields.forEach((el) => {
            if (convertToID(element[1]) === el.attr("name")) {
              $(`#note_${convertToID(element[1])}`).val(el.val());
            }
          });
        });
      };

      const syncEmailWNote = () => {
        emailPlaceholders.forEach((element) => {
          notesPlaceholders.forEach((el) => {
            if (element[1] === el[1]) {
              $(`#email_${convertToID(element[1])}`).val(
                $(`#note_${convertToID(el[1])}`).val()
              );
            }
          });
        });
      };

      const syncEmailWGeneral = () => {
        emailPlaceholders.forEach((element) => {
          generalFields.forEach((el) => {
            if (convertToID(element[1]) === el.attr("name")) {
              $(`#email_${convertToID(element[1])}`).val(el.val());
            }
          });
        });
      };

      const syncSmartWNote = () => {
        smartPlaceholders.forEach((element) => {
          notesPlaceholders.forEach((el) => {
            if (element[1] === el[1]) {
              $(`#smart_${convertToID(element[1])}`).val(
                $(`#note_${convertToID(el[1])}`).val()
              );
            }
          });
        });
      };

      const syncSmartWGeneral = () => {
        smartPlaceholders.forEach((element) => {
          generalFields.forEach((el) => {
            if (convertToID(element[1]) === el.attr("name")) {
              $(`#smart_${convertToID(element[1])}`).val(el.val());
            }
          });
        });
      };

      const updateFinalEmail = () => {
        $("#emailSubject").val(
          $("#selectEmailTemplates").val() + " BAN " + $("#ban").val()
        );
        $("#emailRequest").val(
          $("#emailContent").val() + "\n\n" + localStorage.getItem("signature")
        );
      };

      const updateFastFillEmail = () => {
        emailPlaceholders.forEach((element, index) => {
          const ffInput = $(
            `#email_${element[1].split(" ").join("").toLowerCase()}`
          );
          let currentElement = element[1].split(" ").join("");
          if (ffInput.val() !== "") {
            if (
              $("#emailContent")
                .val()
                .includes(currentEmailState[currentElement])
            ) {
              $("#emailContent").val(
                $("#emailContent")
                  .val()
                  .replace(currentEmailState[currentElement], ffInput.val())
              );
              currentEmailState[currentElement] = ffInput.val();
            } else {
              $("#emailContent").val(
                $("#emailContent").val().replace(element[0], ffInput.val())
              );
              currentEmailState[currentElement] = ffInput.val();
            }
          }
        });
      };

      $("#emailForm").on("input", function (e) {
        e.preventDefault();
        updateFinalEmail();
      });

      $("#fastFillEmail").on("change", (e) => {
        e.preventDefault();
        updateFastFillEmail();
        updateFinalEmail();
      });

      function copyEmail() {
        $("#emailRequest").select();
        document.execCommand("copy");
      }

      // FASTFILL FEATURE

      const reloadTemplates = () => {
        templates_categories.forEach((category) => {
          category && populateSelect(category);
        });
        notesAppendFastFill();
        smartAppendFastFill();
        emailAppendFastFill();
        updateFastFillNote();
        updateFastFillSmart();
        updateFastFillEmail();

        $("#signature").val(
          localStorage.getItem("signature") == null
            ? ""
            : localStorage.getItem("signature")
        );
      };

      $("#saveSignatureBtn").on("click", (e) => {
        e.preventDefault();
        localStorage.setItem("signature", $("#signature").val());
        updateFastFillEmail();
        reloadTemplates();
      });

      reloadTemplates();

      $("#agentelid").on("input", (e) => {
        e.preventDefault();
        if ($("#agentelid").val() != "") {
          $("#authmethod").val("A2A");
          $("#transfer").val("Warm");
        } else {
          $("#authmethod").val("");
          $("#transfer").val("No Transfer");
        }
      });

      $("#ordernumber").on("input", (e) => {
        if ($("#ordernumber").val().includes("or-trtm")) {
          $("#ordertype").val("Telesales Direct Ship");
        } else if (
          $("#ordernumber").val().includes("oy-shso") ||
          $("#ordernumber").val().includes("oy-msho") ||
          $("#ordernumber").val().includes("oy-a1so")
        ) {
          $("#ordertype").val("Websales Direct Ship");
        } else if ($("#ordernumber").val().includes("ow-")) {
          $("#ordertype").val("BOPUIS");
        } else if (
          $("#ordernumber").val().includes("oc-gdrm") ||
          $("#ordernumber").val().includes("oc-ldrm")
        ) {
          $("#ordertype").val("GST Direct Ship");
        } else if ($("#ordernumber").val().includes("or-bdbl")) {
          $("#ordertype").val("Corporate Liable (CL)");
        } else if ($("#ordernumber").val().includes("DM-14")) {
          $("#ordertype").val("DM14 (FDT)");
        } else if (regExp.test($("#ordernumber").val())) {
          $("#ordertype").val("Retail In-Store Purchase");
        } else if ($("#ordernumber").val() == "") {
          $("#ordertype").val("n/a");
        }
      });

      $(".upgres").on("click", (e) => {
        e.preventDefault();
        navigator.clipboard.writeText(
          `@General Please remove upgrade reservation BAN: ${$(
            "#ban"
          ).val()} PTN: ${$("#ptn").val()}`
        );
      });

      document
        .getElementById("uploadNotesTemplates")
        .addEventListener("change", handleTemplatesUpload, false);

      document
        .getElementById("uploadEmailTemplates")
        .addEventListener("change", handleTemplatesUpload, false);

      document
        .getElementById("uploadSmartTemplates")
        .addEventListener("change", handleTemplatesUpload, false);
    </script>
  </body>
</html>
